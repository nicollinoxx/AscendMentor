<div data-current-user="<%= Current.user.id %>"></div>

<% content_for :title, "Messages" %>

<div class="w-full" data-controller='scroll'>
    <%= link_to identity_profile_path(@participant.name), class:  do %>
        <div class='fixed top-20 flex justify-start items-center space-x-2 mt-2'>
          <%= link_to image_tag(@participant.avatar || '', class: 'border-3 border-blue-600 object-cover rounded-full min-w-14 max-w-14 h-14'), identity_profile_path(@participant.name) %>
          <h1 class="text-lg"><%= @participant.name %></h1>
        </div>
    <% end %>

  <%= turbo_stream_from @chat %>

  <div id="messages" data-chat-id="<%= @chat.id %>" class="pb-22 pt-10">
    <% @messages.each do |message| %>
      <%= render message, chat: @chat %>
    <% end %>
  </div>

  <div class="fixed bottom-0 w-full mb-6 container pr-10">
    <div class="text-right mr-4">
      <button data-scroll-target="scrollButton" data-action="click->scroll#scrollToEnd" class="font-bold bg-yellow-100 rounded-full text-yellow-600 p-2">
        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
        </svg>
      </button>
    </div>

    <%= turbo_frame_tag "new_message" do %>
        <% if notice.present? %>
        <p class="py-1 px-3 text-sm bg-green-50 my-2 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
        <% end %>

        <%= render "form", { message: @chat.messages.build } %>
    <% end %>
  </div>
</div>
